<div class="zyfra-nav-menu p-component" #navMenu>
  <div class="header" #header>
    <div class="app-name">{{ menuTitle }}</div>
    <div class="right-side">
      <ng-container *ngTemplateOutlet="headerExtraTemplate"></ng-container>
      <i
        *ngIf="headerConfig?.settings"
        class="toolbar-button zyfra-icon settings-tune"
        (click)="copyConfig(); settingPanel.show($event, header)"
      ></i>
      <i
        *ngIf="headerConfig?.home"
        class="toolbar-button zyfra-icon social-home"
        (click)="homeClick.emit()"
      ></i>
    </div>
  </div>

  <div class="nav-menu-content" [ngClass]="settingsConfig?.selectedSize">
    <ng-container *ngIf="menuGroups.length; else noGroups">
      <zyfra-accordion [multiple]="!settingsConfig.singleGroup">
        <zyfra-accordion-tab *ngFor="let group of menuGroups; let i = index" [selected]="i === activeGroup">
          <ng-template zyfraTemplate="header">
            <span class="p-accordion-header-text groupHeader">
              <i class="zyfra-icon vectors-circle"></i>{{ group.header }}
            </span>
          </ng-template>
          <zyfra-menu-group-content
            [nodes]="groupNodes[i]"
            [selectionMode]="settingsConfig.selectionMode"
            [activeNode]="activeGroup === i ? activeNode : null"
            [searchPlaceholder]="searchPlaceholder"
            [toolbarConfig]="toolbarConfig"
            [toolbarExtra]="toolbarExtraTemplate"
            [itemExtra]="itemExtraTemplate"
            [emptyMessage]="emptyMessage"
            (activeItemChange)="updateActiveItem($event, i)"
            (selectionChange)="selectionChangeHandler($event, i)"
            (nodeCollapse)="nodeCollapseHandler($event, i)"
            (nodeExpand)="nodeExpandHandler($event, i)"
          >
          </zyfra-menu-group-content>
        </zyfra-accordion-tab>
      </zyfra-accordion>
    </ng-container>

    <ng-template #noGroups>
      <zyfra-menu-group-content
        [nodes]="nodes"
        [activeNode]="activeNode"
        [selectionMode]="settingsConfig.selectionMode"
        [searchPlaceholder]="searchPlaceholder"
        [toolbarConfig]="toolbarConfig"
        [toolbarExtra]="toolbarExtraTemplate"
        [itemExtra]="itemExtraTemplate"
        [emptyMessage]="emptyMessage"
        (activeItemChange)="updateActiveItem($event)"
        (selectionChange)="selectionChangeHandler($event)"
        (nodeCollapse)="nodeCollapseHandler($event)"
        (nodeExpand)="nodeExpandHandler($event)"
      >
      </zyfra-menu-group-content>
    </ng-template>
  </div>

  <p-overlayPanel #settingPanel styleClass="settingsPanel" [dismissable]="false" [appendTo]="header">
    <ng-template pTemplate>
      <div>Настройки навигационой панели</div>
      <div class="settings-block">
        <span>Представление</span>
        <zyfra-checkbox
          label="Одиночный режим групповых панелей"
          [(ngModel)]="settingsPanelConfig.singleGroup"
        ></zyfra-checkbox>
        <zyfra-checkbox
          label="Режим множественного выбора элементов"
          [ngModel]="settingsPanelConfig.selectionMode === 'checkbox'"
          (ngModelChange)="settingsPanelConfig.selectionMode = $event ? 'checkbox' : 'single'"
        ></zyfra-checkbox>
      </div>
      <div class="settings-block">
        <span>Степень компактности</span>
        <p-radioButton
          name="size"
          value="standard"
          label="Стандартный вид"
          [(ngModel)]="settingsPanelConfig.selectedSize"
        ></p-radioButton>
        <p-radioButton
          name="size"
          value="enlarged"
          label="Увеличенный вид"
          [(ngModel)]="settingsPanelConfig.selectedSize"
        ></p-radioButton>
      </div>
      <div>
        <zyfra-button
          styleClass="p-button-secondary p-button-mini"
          label="Отмена"
          (onClick)="settingPanel.hide()"
        ></zyfra-button>
        <zyfra-button
          styleClass="p-button-mini"
          label="Подтвердить"
          (onClick)="applySettings(); settingPanel.hide()"
        ></zyfra-button>
      </div>
    </ng-template>
  </p-overlayPanel>
</div>
