<zui-dropdown-host
  #dropdownHostRef
  [content]="dropdown"
  [(isOpen)]="open"
  [zuiDropdownHostWidth]='dropdownWidth'
  [zuiDropdownMinHeight]='minDropdownHeight'
  [zuiDropdownMaxHeight]='maxDropdownHeight'
  *zuiLet='filteredItems$ | async as items'
>
  <zui-input-layout
    [label]="label"
    [forceShowClearButton]='forceShowClearButton'
    (click)='safeOpenModal()'
    (clear)='safeStopPropagation(focusableElementRef.value, $event);'
    [outer]='outer'
    [size]="size">
    <input
      class='input-search'
      zuiInput
      #focusableElementRef
      (onClear)='onClear()'
      [placeholder]="placeholder"
      [disabled]='!searchable || this.disabled'
      [readonly]='!searchable || this.disabled'
      [formControl]="requiredInputControl"
    />
    <zui-icon *ngIf='!disabled'
              (click)='focusableElementRef.focus()'
              [class.active]='focusableElementRef.focused'
              class='icon-dropdown' zui-input-right iconClass='chevrons-dropdown'></zui-icon>
  </zui-input-layout>

  <ng-template #dropdown>
    <zui-data-list class='block'>
      <ng-container *ngIf='items?.length; else emptyTemplate'>
        <div class='item' [class.selected]='item && value && (item | zuiCallFunc : identityMatcher : value)'
             #hostHint
             *ngFor='let item of filteredItems$ | async'
             (click)='select(item)'>
          <ng-container *ngIf='item; else nullContentTemplate'>
            <span class='text'
                  #elem
                  *zuiLet='item | zuiCallFunc : stringify : $any(nullContent) as text'
                  [zuiHint]='text'
                  [zuiHintHost]='hostHint'
                  [zuiHintDirection]='direction'
                  [zuiHintCanShow]='elem | zuiCallFunc : zuiIsTextOverflow$ | async'
            >
              <ng-container *polymorphOutlet="
                valueTemplate as content;
                context: {
                  $implicit: item,
                  stringify: text
                }">
                {{text}}
              </ng-container>
            </span>
          </ng-container>

          <ng-template #nullContentTemplate>
            <ng-container *polymorphOutlet="
                nullContent as content;">
              {{content}}
            </ng-container>
          </ng-template>

        </div>
      </ng-container>
      <ng-template #emptyTemplate>
        <div class='empty-template'>
          <ng-container *polymorphOutlet="
              emptyContent as content;">
            {{content}}
          </ng-container>
        </div>
      </ng-template>
    </zui-data-list>
  </ng-template>
</zui-dropdown-host>
