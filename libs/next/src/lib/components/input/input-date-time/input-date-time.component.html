<pzm-dropdown-host
    [style.--pzm-dropdown-host-width]='"100%"'
    class="z-hosted"
    #pzmDropdownHostComponent
    [canOpen]="interactive"
    [content]="openTimeTemplate ? dropdownTimeTemplate : dropdownDateTemplate"
    [pzmDropdownHostWidth]='openTimeTemplate ? "100%" : "auto"'
    [isOpen]="interactive && (openTimeTemplate || open)"
    [closeByEsc]='true'
    (isOpenChange)="onOpenChange($event)"
>
    <pzm-input-layout
      [label]="label"
      [outer]='outer'
      [size]="size">
      <ng-template pzmInputStatusText>Ошибка! Неправильный формат</ng-template>
      <input
        class='input-search'
        pzmInput
        #focusableElementRef
        [mask]="textMaskOptions"
        [showMaskTyped]='focusableElementRef.focused'
        [dropSpecialCharacters]="false"
        [readonly]='readOnly'
        [placeholder]='placeholder'
        [disabled]='computedDisabled'
        [ngModel]="computedValue"
        (ngModelChange)='onValueChange($event || "")'
      />
      <ng-container pzm-input-right>
        <button
          pzmInputIconButton="date-calendar-blank"
          [interactive]="true"
          (click)='focusableElementRef.focus()'></button>
        <button
          pzmInputIconButton="date-clock"
          (click)='openTimeDropdown();'
          [interactive]="true"
        ></button>
        <ng-container *ngFor='let button of rightButtons$ | async' [ngTemplateOutlet]='button.template'>
        </ng-container>
      </ng-container>
    </pzm-input-layout>
</pzm-dropdown-host>

<ng-template #dropdownDateTemplate>
  <pzm-calendar
    pzmPreventDefault="mousedown"
    automation-id="pzm-input-date-time__calendar"
    [min]="calendarMinDay"
    [max]="calendarMaxDay"
    [disabledItemHandler]="disabledItemHandler"
    [month]="computedActiveYearMonth"
    [value]="calendarValue"
    (dayClick)="onDayClick($event)"
    (monthChange)="onMonthChange($event)"
  ></pzm-calendar>
</ng-template>

<ng-template #dropdownTimeTemplate>
  <pzm-data-list
    pzmLifecycle
    (pzmAfterViewInit)='pzmDropdownHostComponent.reCalculatePositions()'
    (pzmOnDestroy)='openTimeTemplate = false'
    *ngIf='timeItems.length;' class='block' [style.--pzm-data-list-border]='0'>
    <ng-container>
      <div class='time-item'
           *ngFor='let item of timeItems; let idx = index'
           (click)='$event.stopPropagation(); onTimeMenuClick(item, $event)'>
            <span class='text'>
              {{ item }}
            </span>
      </div>
    </ng-container>
  </pzm-data-list>
</ng-template>
